<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>1.4 Approaches to Consensus &mdash; dolphin</title><link rel="stylesheet" href="http://localhost:4000/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/components/collection.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/components/repo-card.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/sections/repo-list.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/components/boxed-group.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/globals/common.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/globals/responsive.css"><link rel="stylesheet" href="http://localhost:4000/assets/css/posts/index.css"><link rel="stylesheet" href="http://localhost:4000/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"><link rel="stylesheet" href="http://localhost:4000/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/"><link rel="alternate" type="application/atom+xml" title="dolphin" href="http://localhost:4000/feed.xml"><link rel="shortcut icon" href="http://localhost:4000/favicon.png"><meta property="og:title" content="1.4 Approaches to Consensus"><meta name="keywords" content="åˆ†å¸ƒå¼, Raft, Paxos, consensus"><meta name="og:keywords" content="åˆ†å¸ƒå¼, Raft, Paxos, consensus"><meta name="description" content="Approaches to Consensus"><meta name="og:description" content="Approaches to Consensus"><meta property="og:url" content="http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/"><meta property="og:site_name" content="dolphin"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-11-19"><title>1.4 Approaches to Consensus | dolphin</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="1.4 Approaches to Consensus" /><meta name="author" content="DempeZheng" /><meta property="og:locale" content="en_US" /><meta name="description" content="åˆ†å¸ƒå¼" /><meta property="og:description" content="åˆ†å¸ƒå¼" /><link rel="canonical" href="http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/" /><meta property="og:url" content="http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/" /><meta property="og:site_name" content="dolphin" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-19T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="1.4 Approaches to Consensus" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"DempeZheng"},"dateModified":"2021-11-19T00:00:00+08:00","datePublished":"2021-11-19T00:00:00+08:00","description":"åˆ†å¸ƒå¼","headline":"1.4 Approaches to Consensus","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/"},"url":"http://localhost:4000/2021/11/19/1.5-Approaches-to-consensus/"}</script> <script src="http://localhost:4000/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="http://localhost:4000/assets/js/jquery-ui.js"></script> <script src="http://localhost:4000/assets/js/main.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-RWCQYNELFN"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RWCQYNELFN'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1> <a href="http://localhost:4000/" title="dolphin"> <span class="octicon octicon-mark-github"></span> dolphin </a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="http://localhost:4000/" class="site-header-nav-item" target="_self" title="ğŸ“°é¦–é¡µ"> <i class="octicon octicon-home"></i> ğŸ“°é¦–é¡µ </a> <a href="http://localhost:4000/categories/" class="site-header-nav-item" target="_self" title="åˆ†ç±»"> <i class="octicon octicon-book"></i> åˆ†ç±» </a> <a href="http://localhost:4000/wiki/" class="site-header-nav-item" target="_self" title="ç»´åŸº"> <i class=""></i> ç»´åŸº </a> <a href="http://localhost:4000/links/" class="site-header-nav-item" target="_self" title="é“¾æ¥"> <i class="octicon octicon-mail"></i> é“¾æ¥ </a> <a href="http://localhost:4000/about/" class="site-header-nav-item" target="_self" title="å…³äº"> <i class="octicon octicon-person"></i> å…³äº </a> <a class="mobile-hidden" href="http://localhost:4000/feed.xml" title="è®¢é˜… RSS"> <i class="octicon octicon-rss" style="color:orange;"></i> </a></nav></div></header><section class="collection-head small " data-pattern-id="55"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">1.4 Approaches to Consensus</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/11/19 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="http://localhost:4000/categories/#æŠ€æœ¯" title="æŠ€æœ¯">æŠ€æœ¯</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> å…± 4880 å­—ï¼Œçº¦ 14 åˆ†é’Ÿ </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="approaches-to-consensus">Approaches to Consensus</h1><h2 id="part1-consensus">Part1. Consensus</h2><p>åˆ†å¸ƒå¼ä¸­å”¯ä¸€é—®é¢˜ï¼šå¯¹æŸä¸ªäº‹è¾¾æˆä¸€è‡´ã€‚e.g.</p><ul><li>åˆ†å¸ƒå¼é”ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œå¤šä¸ªèŠ‚ç‚¹ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„å€¼</li><li>leader electionï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹å¤šä¸ªèŠ‚ç‚¹ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„master</li></ul><h3 id="11-model-of-distribute-system">1.1. Model of Distribute System</h3><ul><li>Network<ul><li>reliable, fair-loss, or arbitrary</li></ul></li><li>Node<ul><li>crash-stop, crash-recovery, or Byzantine</li></ul></li><li>Timing<ul><li>synchronous, partially synchronous, or asynchronous</li></ul></li></ul><h3 id="12-consensus-system-models">1.2. Consensus system models</h3><p>Paxosï¼ŒRaftï¼Œect. Assume a partially synchronous, crash-recovery system model</p><p><strong>Why not asynchronous</strong></p><p>FLP Result:FLP è¯æ˜äº†åœ¨å¼‚æ­¥ç½‘ç»œä¸‹ï¼Œæ²¡æœ‰ä»»ä½•ç®—æ³•èƒ½ä¿è¯ è¿›ç¨‹/èŠ‚ç‚¹ è¾¾æˆä¸€è‡´</p><ul><li>liveness</li><li>safety</li></ul><h3 id="13-approaches-to-consensus">1.3. Approaches to Consensus</h3><ul><li>Symmetric, leader-less:(basic paxos)<ul><li>All servers have equal roles</li><li>Clients can contact any server</li></ul></li><li>Asymmetricï¼Œleader-basedï¼šï¼ˆmulti-paxosï¼Œraftï¼‰<ul><li>At any given time,one server is charge, others accept its decisions</li><li>Clients communicate with the leader</li></ul></li></ul><h2 id="part2-paxos">Part2. Paxos</h2><blockquote><p><em>è¿™ä¸ªä¸–ç•Œä¸Šåªæœ‰ä¸€ç§ä¸€è‡´æ€§ç®—æ³•ï¼Œé‚£å°±æ˜¯Paxos â€¦</em>â€“Google Chubbyçš„ä½œè€…Mike Burrows</p></blockquote><p><a href="https://blog.openacid.com/algo/paxos/">å¯é åˆ†å¸ƒå¼ç³»ç»Ÿ-paxosçš„ç›´è§‚è§£é‡Š</a></p><p><a href="https://ongardie.net/static/raft/userstudy/paxos.pdf">Implementing Replicated Logs with Paxos</a></p><p><strong>paxos å­˜åœ¨é—®é¢˜:</strong></p><ol><li>éš¾ä»¥ç†è§£</li><li>ä¸å…·å¤‡è‰¯å¥½çš„å·¥ç¨‹å®è·µèƒ½åŠ›, multi-paxos ç¼ºä¹å®ç°ç»†èŠ‚</li></ol><blockquote><p>Chubby å®ç°äº†ç±»ä¼¼ paxos çš„ç®—æ³•, ä½†æ˜¯ä¸å…¬å¼€</p></blockquote><h2 id="part3-raftunderstanding-the-raft-consensus-algorithm">Part3. Raftï¼šUnderstanding the Raft consensus algorithm</h2><h3 id="31-ä»‹ç»">3.1. ä»‹ç»</h3><h4 id="311-rafts-design-goals">3.1.1. Raftâ€™s Design Goals</h4><blockquote><p>Paxos is too complex and incomplete for real implementations</p></blockquote><h4 id="312-ä¸ºäº†å¯ç†è§£æ€§è®¾è®¡">3.1.2. ä¸ºäº†å¯ç†è§£æ€§è®¾è®¡</h4><p>å°†é—®é¢˜åˆ†è§£æˆå‡ ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå¯è¢«è§£å†³çš„ã€å¯è§£é‡Šçš„å’Œå¯ç†è§£çš„å­é—®é¢˜ã€‚Raft ç®—æ³•è¢«åˆ†æˆ</p><ol><li>é¢†å¯¼äººé€‰ä¸¾</li><li>æ—¥å¿—å¤åˆ¶</li><li>å®‰å…¨æ€§</li><li>æˆå‘˜å˜æ›´</li></ol><p>å‡å°‘çŠ¶æ€çš„æ•°é‡æ¥ç®€åŒ–éœ€è¦è€ƒè™‘çš„çŠ¶æ€ç©ºé—´ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ è¿è´¯å¹¶ä¸”åœ¨å¯èƒ½çš„æ—¶å€™æ¶ˆé™¤ä¸ç¡®å®šæ€§ï¼š</p><ol><li>æ‰€æœ‰çš„æ—¥å¿—æ˜¯ä¸å…è®¸æœ‰ç©ºæ´çš„ï¼Œå¹¶ä¸” Raft é™åˆ¶äº†æ—¥å¿—ä¹‹é—´å˜æˆä¸ä¸€è‡´çŠ¶æ€çš„å¯èƒ½ã€‚</li><li>ä½¿ç”¨éšæœºåŒ–æ¥ç®€åŒ– Raft ä¸­é¢†å¯¼äººé€‰ä¸¾ç®—æ³•</li></ol><h4 id="313-replication-sate-machine">3.1.3. Replication Sate Machine</h4><p><img src="http://localhost:4000/images/2_1-20211120192216729.png" alt="img" /></p><blockquote><p>å›¾ 1 ï¼šå¤åˆ¶çŠ¶æ€æœºçš„ç»“æ„ã€‚ä¸€è‡´æ€§ç®—æ³•ç®¡ç†ç€æ¥è‡ªå®¢æˆ·ç«¯æŒ‡ä»¤çš„å¤åˆ¶æ—¥å¿—ã€‚çŠ¶æ€æœºä»æ—¥å¿—ä¸­å¤„ç†ç›¸åŒé¡ºåºçš„ç›¸åŒæŒ‡ä»¤ï¼Œæ‰€ä»¥äº§ç”Ÿçš„ç»“æœä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</p></blockquote><h4 id="314-å¤åˆ¶çŠ¶æ€æœºçš„å¸¸è§ç”¨ä¾‹">3.1.4. å¤åˆ¶çŠ¶æ€æœºçš„å¸¸è§ç”¨ä¾‹</h4><p><img src="http://localhost:4000/images/2_2.png" alt="img" /></p><blockquote><p>ä½¿ç”¨å•ä¸ªå¤åˆ¶çŠ¶æ€æœºçš„å¸¸è§æ¨¡å¼ã€‚</p></blockquote><p><img src="http://localhost:4000/images/2_3.png" alt="img" /></p><blockquote><p>ä½¿ç”¨å…±è¯†çš„å¤§å‹åˆ†åŒºå­˜å‚¨ç³»ç»Ÿã€‚ä¸ºäº†æ‰©å±•ï¼Œæ•°æ®åœ¨è®¸å¤šå¤åˆ¶çŠ¶æ€æœºä¹‹é—´è¿›è¡Œäº†åˆ†åŒºã€‚è·¨è¶Šåˆ†åŒºçš„æ“ä½œä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®ã€‚</p></blockquote><h3 id="32-raftç®—æ³•åŸºç¡€">3.2. Raftç®—æ³•åŸºç¡€</h3><p>Rafté¦–å…ˆåœ¨å…±è¯†ç»„ä¸­é€‰å‡ºä¸€ä¸ªleaderï¼Œç„¶åç”±leaderå…¨æƒå¤„ç†LOGçš„å¤åˆ¶ï¼›leaderé¦–å…ˆä»clientå¤„å¾—åˆ°logentryï¼Œç„¶åå°†è¯¥logentryè¯·æ±‚å¤åˆ¶è½¬å‘åˆ°å…¶ä»–serverä¸­ï¼›åœ¨è¯¥logentryæ ‡è®°commitedåï¼Œleaderå†é€šçŸ¥å…¶ä»–serverè¿›è¡Œapplyã€‚è¿™æ ·ç”±leaderæ¥ç»Ÿä¸€å¤„ç†ï¼Œç®€åŒ–äº†æ—¥å¿—çš„å¤åˆ¶ç®¡ç†ã€‚ç”±æ­¤ï¼ŒRaftç®—æ³•å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Leader Electionï¼šå½“leaderå¤±æ•ˆåï¼Œéœ€è¦é€‰ä¸¾å¤„ä¸€ä¸ªæ–°çš„leaderã€‚</li><li>Log Replicationï¼šleaderæ”¶åˆ°æ–°log entryæ—¶ï¼Œéœ€è¦åŠæ—¶å¤åˆ¶ç»™å…¶ä»–serverï¼Œå¹¶ç¡®ä¿å…¶ä»–logä¸è‡ªå·±æœ¬åœ°logè¾¾æˆä¸€è‡´ã€‚</li><li>Safetyï¼šå½“æŸä¸ªserverå°†æŸä¸ªlog indexå¤„çš„logè¿›è¡Œäº†applyåï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ªé›†ç¾¤å†…ï¼Œè¯¥log indexå¤„éƒ½åº”è¯¥applyåŒä¸€æ¡logã€‚</li><li>membership changeï¼šå¢åŠ æˆ–åˆ é™¤å…±è¯†ç»„å†…çš„èŠ‚ç‚¹ã€‚</li></ul><h4 id="321-raftæ¦‚è¿°æµ“ç¼©æ€»ç»“">3.2.1. Raftæ¦‚è¿°ï¼šï¼ˆæµ“ç¼©æ€»ç»“ï¼‰</h4><p><img src="http://localhost:4000/images/raft-å›¾2.png" alt="å›¾ 2" /></p><h4 id="322-raftç‰¹æ€§">3.2.2. Raftç‰¹æ€§</h4><p>Raftç¡®ä¿å…±è¯†ç»„è¿è¡Œä¸­ï¼Œå§‹ç»ˆæ»¡è¶³ä»¥ä¸‹äº”ä¸ªç‰¹æ€§ï¼š</p><p><img src="http://localhost:4000/images/3_2-20211120192217439.png" alt="img" /></p><ol><li><strong>Election Safety</strong>ï¼šæ¯ä¸ªtermä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªleaderï¼›è§Leaderé€‰ä¸¾ç« èŠ‚</li><li><strong>Leader Append-Only</strong>ï¼šLeaderå¯¹äºè‡ªå·±çš„æ—¥å¿—åªä¼šè¿½åŠ ï¼Œä¸ä¿®æ”¹å’Œåˆ é™¤ï¼›è§Logå¤åˆ¶ç« èŠ‚</li><li><strong>Log Matching</strong>ï¼šå¦‚æœä¸¤ä¸ªæ—¥å¿—åŒ…å«ä¸€ä¸ªlogindexå’Œterméƒ½ç›¸åŒçš„entryï¼Œé‚£ä¹ˆè¯¥Entryä¹‹å‰çš„æ—¥å¿—éƒ½ç›¸åŒï¼›è§Logå¤åˆ¶ç« èŠ‚</li><li><strong>Leader Completeness</strong>ï¼šå¦‚æœä¸€ä¸ªlog entryåœ¨æŸä¸ªtermä¸­å·²ç»æäº¤äº†ï¼Œé‚£ä¹ˆä¹‹åçš„termæ¢äº†leaderï¼Œè¯¥commitedçš„entryä»ç„¶åœ¨æ—¥å¿—ä¸­ã€‚è§Safetyç« èŠ‚ã€‚</li><li><strong>State Machine Satety</strong>ï¼šå¦‚æœçŠ¶æ€æœºå·²ç»åº”ç”¨äº†æŸæ¡æ—¥å¿—ï¼Œé‚£ä¹ˆåœ¨è¯¥logindexå¤„ï¼Œä¸èƒ½applyå…¶ä»–entryã€‚è§Safetyç« èŠ‚ã€‚</li></ol><h4 id="323-server-states">3.2.3. Server States</h4><p><img src="http://localhost:4000/images/raft-å›¾4-20211120192216385.png" alt="å›¾ 4 " /></p><blockquote><p>å›¾ 4ï¼šæœåŠ¡å™¨çŠ¶æ€ã€‚è·Ÿéšè€…åªå“åº”æ¥è‡ªå…¶ä»–æœåŠ¡å™¨çš„è¯·æ±‚ã€‚å¦‚æœè·Ÿéšè€…æ¥æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆä»–å°±ä¼šå˜æˆå€™é€‰äººå¹¶å‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚è·å¾—é›†ç¾¤ä¸­å¤§å¤šæ•°é€‰ç¥¨çš„å€™é€‰äººå°†æˆä¸ºé¢†å¯¼äººã€‚åœ¨ä¸€ä¸ªä»»æœŸå†…ï¼Œé¢†å¯¼äººä¸€ç›´éƒ½ä¼šæ˜¯é¢†å¯¼äººï¼Œç›´åˆ°è‡ªå·±å®•æœºäº†ã€‚</p></blockquote><h4 id="324-terms">3.2.4 .Terms</h4><blockquote><p>Term is logic time</p></blockquote><p><img src="http://localhost:4000/images/raft-å›¾5.png" alt="å›¾ 5" /></p><p>Time divided into terms:</p><ul><li>Election</li><li>Normal operation under a singel leader</li><li>Some terms have no leader(failed election)</li><li>At most 1 leader per term</li><li>Each server maintains current term value</li></ul><h4 id="325heartbeats-and-timeouts">3.2.5..Heartbeats and Timeouts</h4><blockquote><p>å¹¿æ’­æ—¶é—´ï¼ˆbroadcastTimeï¼‰ Â«Â é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼ˆelectionTimeoutï¼‰ Â«Â å¹³å‡æ•…éšœé—´éš”æ—¶é—´ï¼ˆMTBFï¼‰</p></blockquote><ul><li>Servers start up as follwers</li><li>Follwers expects to receive RPCs from leader or candidates</li><li>Leaders must send heartbeats to maintain authority</li><li>If electionTimeout elapses with no RPCs:<ul><li>Follower assumes leader has crashed</li><li>Follower starts new election</li><li>Timeouts typically 100-500ms</li></ul></li></ul><h3 id="33safety">3.3.Safety:</h3><blockquote><p>Safetyï¼šåœ¨æ•…éšœå‘ç”Ÿæ—¶ï¼Œå…±è¯†ç³»ç»Ÿä¸èƒ½äº§ç”Ÿé”™è¯¯çš„ç»“æœã€‚</p></blockquote><h4 id="331allow-at-most-one-winer-per-term">3.3.1.allow at most one winer per term</h4><p>Each server gives out only one vote per termï¼ˆpersist on diskï¼‰</p><p>Two different candidates canâ€™t accumulate majorities in same term</p><h4 id="332leader-completeness">3.3.2.Leader completeness</h4><p><strong>é€‰ä¸¾é™åˆ¶ï¼š</strong></p><p>Raft ä½¿ç”¨äº†ä¸€ç§æ›´åŠ ç®€å•çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¿è¯æ‰€æœ‰ä¹‹å‰çš„ä»»æœŸå·ä¸­å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®åœ¨é€‰ä¸¾çš„æ—¶å€™éƒ½ä¼šå‡ºç°åœ¨æ–°çš„é¢†å¯¼äººä¸­ï¼Œä¸éœ€è¦ä¼ é€è¿™äº›æ—¥å¿—æ¡ç›®ç»™é¢†å¯¼äººã€‚è¿™æ„å‘³ç€æ—¥å¿—æ¡ç›®çš„ä¼ é€æ˜¯å•å‘çš„ï¼Œåªä»é¢†å¯¼äººä¼ ç»™è·Ÿéšè€…ï¼Œå¹¶ä¸”é¢†å¯¼äººä»ä¸ä¼šè¦†ç›–è‡ªèº«æœ¬åœ°æ—¥å¿—ä¸­å·²ç»å­˜åœ¨çš„æ¡ç›®</p><p>è¯·æ±‚æŠ•ç¥¨ RPC å®ç°äº†è¿™æ ·çš„é™åˆ¶ï¼šRPC ä¸­åŒ…å«äº†å€™é€‰äººçš„æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åæŠ•ç¥¨äººä¼šæ‹’ç»æ‰é‚£äº›æ—¥å¿—æ²¡æœ‰è‡ªå·±æ–°çš„æŠ•ç¥¨è¯·æ±‚ã€‚</p><p>Raft é€šè¿‡æ¯”è¾ƒä¸¤ä»½æ—¥å¿—ä¸­æœ€åä¸€æ¡æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å’Œä»»æœŸå·å®šä¹‰è°çš„æ—¥å¿—æ¯”è¾ƒæ–°ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®çš„ä»»æœŸå·ä¸åŒï¼Œé‚£ä¹ˆä»»æœŸå·å¤§çš„æ—¥å¿—æ›´åŠ æ–°ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®ä»»æœŸå·ç›¸åŒï¼Œé‚£ä¹ˆæ—¥å¿—æ¯”è¾ƒé•¿çš„é‚£ä¸ªå°±æ›´åŠ æ–°ã€‚</p><h4 id="373-commit-entries-from-a-previous-term">3.7.3. commit entries from a previous term</h4><p><img src="http://localhost:4000/images/3_7-20211120192216718.png" alt="img" /></p><blockquote><p>å›¾ 3.7ï¼šå¦‚å›¾çš„æ—¶é—´åºåˆ—å±•ç¤ºäº†ä¸ºä»€ä¹ˆé¢†å¯¼è€…æ— æ³•å†³å®šå¯¹è€ä»»æœŸå·çš„æ—¥å¿—æ¡ç›®è¿›è¡Œæäº¤ã€‚åœ¨ (a) ä¸­ï¼ŒS1 æ˜¯é¢†å¯¼è€…ï¼Œéƒ¨åˆ†çš„å¤åˆ¶äº†ç´¢å¼•ä½ç½® 2 çš„æ—¥å¿—æ¡ç›®ã€‚åœ¨ (b) ä¸­ï¼ŒS1 å´©æºƒäº†ï¼Œç„¶å S5 åœ¨ä»»æœŸ 3 é‡Œé€šè¿‡ S3ã€S4 å’Œè‡ªå·±çš„é€‰ç¥¨èµ¢å¾—é€‰ä¸¾ï¼Œç„¶åä»å®¢æˆ·ç«¯æ¥æ”¶äº†ä¸€æ¡ä¸ä¸€æ ·çš„æ—¥å¿—æ¡ç›®æ”¾åœ¨äº†ç´¢å¼• 2 å¤„ã€‚ç„¶ååˆ° (c)ï¼ŒS5 åˆå´©æºƒäº†ï¼›S1 é‡æ–°å¯åŠ¨ï¼Œé€‰ä¸¾æˆåŠŸï¼Œå¼€å§‹å¤åˆ¶æ—¥å¿—ã€‚åœ¨è¿™æ—¶ï¼Œæ¥è‡ªä»»æœŸ 2 çš„é‚£æ¡æ—¥å¿—å·²ç»è¢«å¤åˆ¶åˆ°äº†é›†ç¾¤ä¸­çš„å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æäº¤ã€‚å¦‚æœ S1 åœ¨ (d) ä¸­åˆå´©æºƒäº†ï¼ŒS5 å¯ä»¥é‡æ–°è¢«é€‰ä¸¾æˆåŠŸï¼ˆé€šè¿‡æ¥è‡ª S2ï¼ŒS3 å’Œ S4 çš„é€‰ç¥¨ï¼‰ï¼Œç„¶åè¦†ç›–äº†ä»–ä»¬åœ¨ç´¢å¼• 2 å¤„çš„æ—¥å¿—ã€‚åä¹‹ï¼Œå¦‚æœåœ¨å´©æºƒä¹‹å‰ï¼ŒS1 æŠŠè‡ªå·±ä¸»å¯¼çš„æ–°ä»»æœŸé‡Œäº§ç”Ÿçš„æ—¥å¿—æ¡ç›®å¤åˆ¶åˆ°äº†å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œå°±å¦‚ (e) ä¸­é‚£æ ·ï¼Œé‚£ä¹ˆåœ¨åé¢ä»»æœŸé‡Œé¢è¿™äº›æ–°çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ï¼ˆå› ä¸º S5 å°±ä¸å¯èƒ½é€‰ä¸¾æˆåŠŸï¼‰ã€‚ è¿™æ ·åœ¨åŒä¸€æ—¶åˆ»å°±åŒæ—¶ä¿è¯äº†ï¼Œä¹‹å‰çš„æ‰€æœ‰è€çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ã€‚</p></blockquote><ul><li>leaderä¸èƒ½commit entries from a previous termï¼Œåœ¨ï¼ˆcï¼‰S1 commited preTermçš„2æ˜¯ä¸è¢«å…è®¸çš„ã€‚</li><li>raft çš„æ–°çš„leaderèŠ‚ç‚¹å¯ä»¥æäº¤è‡ªå·±ä»»æœŸçš„æ—¥å¿—æ¡ç›®ï¼Œé€šè¿‡log matchingçš„ç‰¹æ€§ï¼Œå¦‚æœå½“å‰çš„æ—¥å¿—æ¡ç›®æäº¤ï¼Œå‰ä»»æœŸçš„æ—¥å¿—é—´æ¥çš„è¢«æäº¤ã€‚</li></ul><p>å¦å¤–ï¼ŒRaftå¯¹äºæ—§çš„æ—¥å¿—æ¡ç›®ä¼šå‘é€æ—§çš„ä»»æœŸå·ï¼Œè¿™ä½¿å¾—æ—¥å¿—æ›´å®¹æ˜“è¢«ç†è§£å’Œè¯†åˆ«ï¼›</p><h3 id="34liveness">3.4.Liveness</h3><blockquote><p>ç³»ç»Ÿèƒ½æŒç»­äº§ç”Ÿæäº¤ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ°¸è¿œå¤„äºä¸€ä¸ªä¸­é—´çŠ¶æ€æ— æ³•ç»§ç»­</p></blockquote><h4 id="341raft-use-randomized-election-timeout">3.4.1.Raft use randomized election timeout</h4><ul><li>Choose election timeouts randomly in [T,2T]</li><li>One server usually times out and wins election before others wake up</li><li>Work well if TÂ»broadcast time</li></ul><h4 id="342prevotecheckquorums">3.4.2.preVote+checkQuorums</h4><blockquote><p>PreVoteï¼šé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½å‘æ¶ˆæ¯ï¼Œä½†æ˜¯æ— æ³•æ”¶æ¶ˆæ¯ï¼Œä»–ä¼šä¸€ç›´å¿ƒè·³è¶…æ—¶ï¼Œç„¶åå‘èµ·æ–°çš„é€‰ä¸¾ï¼Œå¯¼è‡´leaderä¸‹å°</p></blockquote><p>https://www.zhihu.com/question/483967518/answer/2097076504</p><h3 id="35-reference">3.5. reference</h3><p><a href="https://github.com/LebronAl/raft-thesis-zh_cn/blob/master/raft-thesis-zh_cn.md">Raft åšå£«è®ºæ–‡ï¼ˆä¸­æ–‡ï¼‰</a></p><p><a href="http://www.kailing.pub/raft/index.html">RaftåŠ¨ç”»æ¼”ç¤º</a></p><p><a href="https://cs5450.github.io/lectures/raft.pdf">Raftï¼šSlides from Diego Ongaro and John Ousterhout</a></p><h2 id="part4-multi-paxos-vs-raft">Part4. Multi-Paxos VS Raft</h2><p>Raftç›¸æ¯”äºPaxosæ›´ç®€å•</p><ol><li>å…±è¯†é—®é¢˜ç®€åŒ–æˆä¸‰ä¸ªç‹¬ç«‹çš„é—®é¢˜: leader electionã€log replicationã€safety[logIndex-&gt;logå”¯ä¸€ä¸”ä¸å¯å˜]</li><li>ä¸å…è®¸ç±»ä¼¼paxosçš„ä¹±åºæäº¤</li><li>ä½¿ç”¨ Randomization ç®—æ³•ç®€åŒ–leader electioné—®é¢˜.</li><li>ä½¿ç”¨termæ¦‚å¿µä»£æ›¿åŸå­é’Ÿçš„æ¦‚å¿µ</li></ol><h3 id="41-multi-paxoså…è®¸æ—¥å¿—å‡ºç°ç©ºæ´raftä¸å…è®¸">4.1. Multi-Paxoså…è®¸æ—¥å¿—å‡ºç°ç©ºæ´ï¼ŒRaftä¸å…è®¸</h3><p>paxosæ˜¯å…è®¸å¹¶å‘çš„ï¼ŒRaftä¸å…è®¸å¹¶å‘ï¼ŒRaftçš„leaderçš„appendå¿…é¡»æ˜¯è¿ç»­çš„ã€‚</p><p><img src="http://localhost:4000/images/image-20211120201023278.png" alt="image-20211120201023278" /></p><p><img src="http://localhost:4000/images/3_5-20211120201328654.png" alt="img" /></p><h3 id="42-rafté€‰ä¸»æœ‰é™åˆ¶è¦æ±‚leader-completeness">4.2. Rafté€‰ä¸»æœ‰é™åˆ¶ï¼Œè¦æ±‚Leader Completeness</h3><p>é€‰ä¸»æ˜¯æœ‰é™åˆ¶çš„, å¿…é¡»æœ‰æœ€æ–°, æœ€å…¨çš„æ—¥å¿—èŠ‚ç‚¹æ‰å¯ä»¥å½“é€‰. è€Œmulti-paxos æ˜¯éšæ„çš„ æ‰€ä»¥raft å¯ä»¥çœ‹æˆæ˜¯ç®€åŒ–ç‰ˆæœ¬çš„multi paxos(è¿™é‡Œmulti-paxos å› ä¸ºå…è®¸å¹¶å‘çš„å†™log, å› æ­¤ä¸å­˜åœ¨ä¸€ä¸ªæœ€æ–°, æœ€å…¨çš„æ—¥å¿—èŠ‚ç‚¹, å› æ­¤åªèƒ½è¿™ä¹ˆåš. è¿™æ ·å¸¦æ¥çš„éº»çƒ¦å°±æ˜¯é€‰ä¸»ä»¥å, éœ€è¦å°†ä¸»é‡Œé¢æ²¡æœ‰çš„log ç»™è¡¥å…¨, å¹¶æ‰§è¡Œcommit è¿‡ç¨‹)</p><h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2><p><a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">paxos-simple.pdf</a></p><p><a href="https://cs5450.github.io/lectures/raft.pdf">raft.pdf</a></p><p><a href="http://cs.brown.edu/courses/cs138/s16/lectures/11raft.pdf">11raft.pdf</a></p><p><a href="https://courses.grainger.illinois.edu/ece428/sp2020//assets/slides/lect17.pdf">slides-lect17.pdf</a></p><p><a href="https://www.bilibili.com/video/BV19v411C7Dj">raftåè®®è®²è§£ç¬¬ä¸€éƒ¨åˆ†</a></p><p><a href="https://blog.openacid.com/algo/paxos/">å¯é åˆ†å¸ƒå¼ç³»ç»Ÿ-paxosçš„ç›´è§‚è§£é‡Š</a></p><p><a href="https://baotiao.github.io/2016/05/05/paxos-raft/">paxos-raft</a></p><p><a href="https://xujianhai.fun/posts/raft-paper/">raft-paper</a></p><p><a href="https://github.com/LebronAl/raft-thesis-zh_cn/blob/master/raft-thesis-zh_cn.md">master/raft-thesis-zh_cn.md</a></p></article><div class="share"><div class="share-component" data-disabled='qq,douban,qzone,linkedin'></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="http://localhost:4000/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/11/19/1.5-Approaches-to-consensus/', clientID: 'Ov23li6FmCJDmAIlZmNK', clientSecret: '81bd012195b582aa2cabb7d2d472dd173353beef', repo: 'blog-comments', owner: 'HeroesZheng', admin: ['HeroesZheng'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="http://localhost:4000/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> Â© 2015 <span title="DempeZheng">DempeZheng</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="http://localhost:4000/" title="ğŸ“°é¦–é¡µ" target="">ğŸ“°é¦–é¡µ</a></li><li> <a href="http://localhost:4000/categories/" title="åˆ†ç±»" target="">åˆ†ç±»</a></li><li> <a href="http://localhost:4000/wiki/" title="ç»´åŸº" target="">ç»´åŸº</a></li><li> <a href="http://localhost:4000/links/" title="é“¾æ¥" target="">é“¾æ¥</a></li><li> <a href="http://localhost:4000/about/" title="å…³äº" target="">å…³äº</a></li><li><a href="http://localhost:4000/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="å›åˆ°é¡¶éƒ¨"><span class="octicon octicon-arrow-up"></span></a></div><script src="http://localhost:4000/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="http://localhost:4000/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
